<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MPP-Solar Charts - Historical Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        body {
            background-color: #f8f9fa;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
            margin-bottom: 20px;
        }
        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px 0;
        }
        .nav-tabs .nav-link {
            color: #495057;
        }
        .nav-tabs .nav-link.active {
            color: #007bff;
            font-weight: bold;
        }
        .time-range-selector {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        .no-data {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row bg-white shadow-sm py-3 mb-4">
            <div class="col">
                <h1 class="h3 mb-0">
                    <i class="fas fa-chart-line text-primary"></i>
                    MPP-Solar Historical Data Charts
                </h1>
                <small class="text-muted">Interactive line graphs of inverter performance over time</small>
            </div>
            <div class="col-auto">
                <a href="/" class="btn btn-outline-primary">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
            </div>
        </div>

        <!-- Time Range Selector -->
        <div class="time-range-selector">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <label for="timeRange" class="form-label">Time Range:</label>
                    <select class="form-select" id="timeRange">
                        <option value="1">Last Hour</option>
                        <option value="6">Last 6 Hours</option>
                        <option value="12">Last 12 Hours</option>
                        <option value="24" selected>Last 24 Hours</option>
                        <option value="48">Last 48 Hours</option>
                        <option value="168">Last Week (All Data)</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <button class="btn btn-primary" id="refreshCharts">
                        <i class="fas fa-sync-alt"></i> Refresh Charts
                    </button>
                    <span class="ms-3 text-muted" id="lastUpdate">Last update: Never</span>
                </div>
            </div>
        </div>

        <!-- Charts Navigation -->
        <ul class="nav nav-tabs" id="chartTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="voltage-tab" data-bs-toggle="tab" data-bs-target="#voltage" type="button" role="tab">
                    <i class="fas fa-bolt"></i> Voltage
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="power-tab" data-bs-toggle="tab" data-bs-target="#power" type="button" role="tab">
                    <i class="fas fa-plug"></i> Power
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="temperature-tab" data-bs-toggle="tab" data-bs-target="#temperature" type="button" role="tab">
                    <i class="fas fa-thermometer-half"></i> Temperature
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="current-tab" data-bs-toggle="tab" data-bs-target="#current" type="button" role="tab">
                    <i class="fas fa-tachometer-alt"></i> Current
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="status-tab" data-bs-toggle="tab" data-bs-target="#status" type="button" role="tab">
                    <i class="fas fa-info-circle"></i> Status
                </button>
            </li>
        </ul>

        <!-- Charts Content -->
        <div class="tab-content" id="chartTabsContent">
            <!-- Voltage Charts -->
            <div class="tab-pane fade show active" id="voltage" role="tabpanel">
                <div class="row">
                    <!-- Battery Voltage Chart -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-battery-three-quarters text-warning"></i>
                                    Battery Voltage
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="batteryVoltageChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AC Input Voltage Chart -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-plug text-danger"></i>
                                    AC Input Voltage
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="acInputVoltageChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Power Charts -->
            <div class="tab-pane fade" id="power" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-plug text-success"></i>
                                    Power Output & Load
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="powerChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Temperature Charts -->
            <div class="tab-pane fade" id="temperature" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-thermometer-half text-danger"></i>
                                    Temperature Monitoring
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="temperatureChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Charts -->
            <div class="tab-pane fade" id="current" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-tachometer-alt text-info"></i>
                                    Current Monitoring
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="currentChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Charts -->
            <div class="tab-pane fade" id="status" role="tabpanel">
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-info-circle text-primary"></i>
                                    System Status
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="chart-container">
                                    <canvas id="statusChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Summary -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-table text-secondary"></i>
                            Data Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="dataSummary">
                            <div class="loading">
                                <i class="fas fa-spinner fa-spin"></i> Loading data summary...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let charts = {};
        let historicalData = {};

        // Chart.js configuration
        const chartConfig = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                x: {
                    type: 'time',
                    time: {
                        displayFormats: {
                            hour: 'HH:mm',
                            minute: 'HH:mm',
                            second: 'HH:mm:ss'
                        }
                    },
                    title: {
                        display: true,
                        text: 'Time'
                    }
                },
                y: {
                    title: {
                        display: true,
                        text: 'Value'
                    }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            }
        };

        // Error handling helper function
        function showChartError(canvasId, message) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error(`Cannot show error: canvas ${canvasId} not found`);
                return;
            }

            // Hide the canvas
            canvas.style.display = 'none';

            // Find the chart container
            const container = canvas.closest('.chart-container');
            if (!container) {
                console.error(`Cannot show error: container for ${canvasId} not found`);
                return;
            }

            // Create error message element
            const errorDiv = document.createElement('div');
            errorDiv.className = 'alert alert-warning d-flex align-items-center justify-content-between';
            errorDiv.innerHTML = `
                <div>
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <span>${message}</span>
                </div>
                <button class="btn btn-sm btn-primary retry-chart-btn" data-canvas-id="${canvasId}">
                    <i class="fas fa-redo"></i> Retry
                </button>
            `;

            // Add to container
            container.appendChild(errorDiv);

            // Add retry button handler
            const retryBtn = errorDiv.querySelector('.retry-chart-btn');
            retryBtn.addEventListener('click', function() {
                errorDiv.remove();
                canvas.style.display = 'block';
                initializeCharts();
            });
        }

        // Initialize all charts with error handling
        function initializeCharts() {
            // Battery Voltage Chart
            try {
                const batteryVoltageCtx = document.getElementById('batteryVoltageChart');
                if (!batteryVoltageCtx) {
                    console.warn('Battery Voltage Chart canvas not found');
                    return;
                }

                // Efficient config clone - only override what's needed
                const batteryVoltageConfig = {
                    ...chartConfig,
                    scales: {
                        ...chartConfig.scales,
                        y: {
                            ...chartConfig.scales.y,
                            min: 38,
                            max: 52,
                            title: {
                                ...chartConfig.scales.y.title,
                                text: 'Voltage (V)'
                            }
                        }
                    }
                };

                charts.batteryVoltage = new Chart(batteryVoltageCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Battery Voltage (V)',
                            borderColor: 'rgb(255, 193, 7)',
                            backgroundColor: 'rgba(255, 193, 7, 0.1)',
                            data: []
                        }]
                    },
                    options: batteryVoltageConfig
                });
                console.log('Battery Voltage Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Battery Voltage Chart:', error);
                showChartError('batteryVoltageChart', 'Battery Voltage chart failed to initialize');
            }

            // AC Input Voltage Chart
            try {
                const acInputVoltageCtx = document.getElementById('acInputVoltageChart');
                if (!acInputVoltageCtx) {
                    console.warn('AC Input Voltage Chart canvas not found');
                    return;
                }

                charts.acInputVoltage = new Chart(acInputVoltageCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'AC Input Voltage (V)',
                            borderColor: 'rgb(220, 53, 69)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            data: []
                        }]
                    },
                    options: chartConfig
                });
                console.log('AC Input Voltage Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize AC Input Voltage Chart:', error);
                showChartError('acInputVoltageChart', 'AC Input Voltage chart failed to initialize');
            }

            // Power Chart
            try {
                const powerCtx = document.getElementById('powerChart');
                if (!powerCtx) {
                    console.warn('Power Chart canvas not found');
                    return;
                }

                charts.power = new Chart(powerCtx, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                label: 'Active Power (W)',
                                borderColor: 'rgb(0, 123, 255)',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                data: []
                            },
                            {
                                label: 'Apparent Power (VA)',
                                borderColor: 'rgb(40, 167, 69)',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                data: []
                            },
                            {
                                label: 'Load (%)',
                                borderColor: 'rgb(23, 162, 184)',
                                backgroundColor: 'rgba(23, 162, 184, 0.1)',
                                data: []
                            }
                        ]
                    },
                    options: chartConfig
                });
                console.log('Power Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Power Chart:', error);
                showChartError('powerChart', 'Power chart failed to initialize');
            }

            // Temperature Chart
            try {
                const temperatureCtx = document.getElementById('temperatureChart');
                if (!temperatureCtx) {
                    console.warn('Temperature Chart canvas not found');
                    return;
                }

                charts.temperature = new Chart(temperatureCtx, {
                    type: 'line',
                    data: {
                        datasets: [{
                            label: 'Temperature (°C)',
                            borderColor: 'rgb(220, 53, 69)',
                            backgroundColor: 'rgba(220, 53, 69, 0.1)',
                            data: []
                        }]
                    },
                    options: chartConfig
                });
                console.log('Temperature Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Temperature Chart:', error);
                showChartError('temperatureChart', 'Temperature chart failed to initialize');
            }

            // Current Chart
            try {
                const currentCtx = document.getElementById('currentChart');
                if (!currentCtx) {
                    console.warn('Current Chart canvas not found');
                    return;
                }

                charts.current = new Chart(currentCtx, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                label: 'Charging Current (A)',
                                borderColor: 'rgb(40, 167, 69)',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                data: []
                            },
                            {
                                label: 'Discharge Current (A)',
                                borderColor: 'rgb(255, 193, 7)',
                                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                                data: []
                            }
                        ]
                    },
                    options: chartConfig
                });
                console.log('Current Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Current Chart:', error);
                showChartError('currentChart', 'Current chart failed to initialize');
            }

            // Status Chart
            try {
                const statusCtx = document.getElementById('statusChart');
                if (!statusCtx) {
                    console.warn('Status Chart canvas not found');
                    return;
                }

                charts.status = new Chart(statusCtx, {
                    type: 'line',
                    data: {
                        datasets: [
                            {
                                label: 'Charging On',
                                borderColor: 'rgb(40, 167, 69)',
                                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                                data: []
                            },
                            {
                                label: 'Switched On',
                                borderColor: 'rgb(0, 123, 255)',
                                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                                data: []
                            },
                            {
                                label: 'Load On',
                                borderColor: 'rgb(255, 193, 7)',
                                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                                data: []
                            }
                        ]
                    },
                    options: chartConfig
                });
                console.log('Status Chart initialized successfully');
            } catch (error) {
                console.error('Failed to initialize Status Chart:', error);
                showChartError('statusChart', 'Status chart failed to initialize');
            }
        }

        // Update chart data with comprehensive error handling
        function updateChartData() {
            const hours = parseInt(document.getElementById('timeRange').value);

            // Show loading state
            const dataSummaryDiv = document.getElementById('dataSummary');
            dataSummaryDiv.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading data...</div>';

            // Use all historical data endpoint for better chart visualization
            const endpoint = hours >= 168 ? '/api/historical/all' : `/api/historical?hours=${hours}`;

            fetch(endpoint)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    // Validate data structure
                    if (!data || typeof data !== 'object') {
                        throw new Error('Invalid data format received from server');
                    }

                    // Check if we got sufficient data
                    const hasData = Object.keys(data).length > 0;
                    const dataPoints = hasData ? Object.values(data)[0]?.length || 0 : 0;

                    // Only fallback to all data if we have NO data at all
                    if (dataPoints === 0) {
                        console.log(`No data returned for ${hours}h filter, falling back to all data`);
                        return fetch('/api/historical/all')
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                                }
                                return response.json();
                            });
                    }

                    return data;
                })
                .then(data => {
                    if (!data || Object.keys(data).length === 0) {
                        console.warn('No historical data available');
                        dataSummaryDiv.innerHTML = `
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle me-2"></i>
                                No historical data available yet. Data will appear as the daemon collects metrics.
                            </div>
                        `;
                        return;
                    }

                    historicalData = data;
                    updateCharts();
                    updateDataSummary();
                    document.getElementById('lastUpdate').textContent = `Last update: ${new Date().toLocaleTimeString()}`;
                })
                .catch(error => {
                    console.error('Error fetching historical data:', error);

                    // Show user-friendly error message with retry button
                    dataSummaryDiv.innerHTML = `
                        <div class="alert alert-danger d-flex align-items-center justify-content-between">
                            <div>
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Error loading data:</strong> ${error.message}
                            </div>
                            <button class="btn btn-sm btn-danger" onclick="updateChartData()">
                                <i class="fas fa-redo"></i> Retry
                            </button>
                        </div>
                    `;
                });
        }

        // Update individual charts with graceful degradation
        function updateCharts() {
            try {
                // Battery Voltage Chart
                if (charts.batteryVoltage) {
                    const data = getChartData('mpp_solar_battery_voltage');
                    charts.batteryVoltage.data.datasets[0].data = data;
                    charts.batteryVoltage.update();
                    if (data.length === 0) {
                        console.warn('No data available for Battery Voltage chart');
                    }
                }

                // AC Input Voltage Chart
                if (charts.acInputVoltage) {
                    const data = getChartData('mpp_solar_ac_input_voltage');
                    charts.acInputVoltage.data.datasets[0].data = data;
                    charts.acInputVoltage.update();
                    if (data.length === 0) {
                        console.warn('No data available for AC Input Voltage chart');
                    }
                }

                // Power Chart
                if (charts.power) {
                    const activePower = getChartData('mpp_solar_ac_output_active_power');
                    const apparentPower = getChartData('mpp_solar_ac_output_apparent_power');
                    const load = getChartData('mpp_solar_ac_output_load');

                    charts.power.data.datasets[0].data = activePower;
                    charts.power.data.datasets[1].data = apparentPower;
                    charts.power.data.datasets[2].data = load;
                    charts.power.update();

                    if (activePower.length === 0 && apparentPower.length === 0 && load.length === 0) {
                        console.warn('No data available for Power chart');
                    }
                }

                // Temperature Chart
                if (charts.temperature) {
                    const data = getChartData('mpp_solar_inverter_heat_sink_temperature');
                    charts.temperature.data.datasets[0].data = data;
                    charts.temperature.update();
                    if (data.length === 0) {
                        console.warn('No data available for Temperature chart');
                    }
                }

                // Current Chart
                if (charts.current) {
                    const chargingCurrent = getChartData('mpp_solar_battery_charging_current');
                    const dischargeCurrent = getChartData('mpp_solar_battery_discharge_current');

                    charts.current.data.datasets[0].data = chargingCurrent;
                    charts.current.data.datasets[1].data = dischargeCurrent;
                    charts.current.update();

                    if (chargingCurrent.length === 0 && dischargeCurrent.length === 0) {
                        console.warn('No data available for Current chart');
                    }
                }

                // Status Chart
                if (charts.status) {
                    const chargingOn = getChartData('mpp_solar_is_charging_on');
                    const switchedOn = getChartData('mpp_solar_is_switched_on');
                    const loadOn = getChartData('mpp_solar_is_load_on');

                    charts.status.data.datasets[0].data = chargingOn;
                    charts.status.data.datasets[1].data = switchedOn;
                    charts.status.data.datasets[2].data = loadOn;
                    charts.status.update();

                    if (chargingOn.length === 0 && switchedOn.length === 0 && loadOn.length === 0) {
                        console.warn('No data available for Status chart');
                    }
                }
            } catch (error) {
                console.error('Error updating charts:', error);
                // Don't throw - allow charts to continue working with existing data
            }
        }

        // Get data for a specific metric
        function getChartData(metricName) {
            if (!historicalData[metricName]) return [];
            
            // Get selected time range
            const hours = parseInt(document.getElementById('timeRange').value);
            const now = new Date();
            const cutoffTime = new Date(now.getTime() - (hours * 60 * 60 * 1000));
            
            // Filter and map data
            return historicalData[metricName]
                .map(item => ({
                    x: new Date(item.timestamp),
                    y: item.value
                }))
                .filter(item => item.x >= cutoffTime);
        }

        // Update data summary
        function updateDataSummary() {
            const summaryDiv = document.getElementById('dataSummary');
            let summaryHTML = '<div class="row">';
            
            const metrics = [
                { name: 'Battery Voltage', key: 'mpp_solar_battery_voltage', unit: 'V', color: 'warning' },
                { name: 'AC Input Voltage', key: 'mpp_solar_ac_input_voltage', unit: 'V', color: 'danger' },
                { name: 'Output Power', key: 'mpp_solar_ac_output_active_power', unit: 'W', color: 'primary' },
                { name: 'Temperature', key: 'mpp_solar_inverter_heat_sink_temperature', unit: '°C', color: 'danger' },
                { name: 'Load', key: 'mpp_solar_ac_output_load', unit: '%', color: 'info' },
                { name: 'Charging Current', key: 'mpp_solar_battery_charging_current', unit: 'A', color: 'success' }
            ];

            metrics.forEach(metric => {
                const data = historicalData[metric.key];
                if (data && data.length > 0) {
                    const latest = data[data.length - 1];
                    const avg = data.reduce((sum, item) => sum + item.value, 0) / data.length;
                    const min = Math.min(...data.map(item => item.value));
                    const max = Math.max(...data.map(item => item.value));
                    
                    summaryHTML += `
                        <div class="col-md-4 mb-3">
                            <div class="metric-card">
                                <h6>${metric.name}</h6>
                                <div class="row">
                                    <div class="col-6">
                                        <small>Current: ${latest.value.toFixed(1)} ${metric.unit}</small><br>
                                        <small>Average: ${avg.toFixed(1)} ${metric.unit}</small>
                                    </div>
                                    <div class="col-6">
                                        <small>Min: ${min.toFixed(1)} ${metric.unit}</small><br>
                                        <small>Max: ${max.toFixed(1)} ${metric.unit}</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
            
            summaryHTML += '</div>';
            summaryDiv.innerHTML = summaryHTML;
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize charts
            initializeCharts();
            
            // Load initial data
            updateChartData();
            
            // Set up refresh button
            document.getElementById('refreshCharts').addEventListener('click', updateChartData);
            
            // Set up time range selector
            document.getElementById('timeRange').addEventListener('change', updateChartData);
            
            // Auto-refresh every 5 minutes
            setInterval(updateChartData, 300000);
        });
    </script>
</body>
</html>
